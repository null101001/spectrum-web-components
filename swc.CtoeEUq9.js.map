{"version":3,"file":"swc.BgRubb97.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js"],"sourcesContent":["\"use strict\";function o(r,e,t){return typeof r===e?()=>r:typeof r==\"function\"?r:t}export class FocusGroupController{constructor(e,{hostDelegatesFocus:t,direction:n,elementEnterAction:s,elements:i,focusInIndex:h,isFocusableElement:c,listenerScope:l,stopKeyEventPropagation:u}={elements:()=>[]}){this._currentIndex=-1;this.prevIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.hostDelegatesFocus=!1;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.recentlyConnected=!1;this.stopKeyEventPropagation=!1;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.prevIndex=this.currentIndex,this.currentIndex=n>-1?n:this.currentIndex,this.isRelatedTargetOrContainAnElement(e)&&this.hostContainsFocus()};this.handleClick=()=>{var n;const e=this.elements;if(!e.length)return;let t=e[this.currentIndex];this.currentIndex<0||((!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=e[this.currentIndex]),t&&this.isFocusableElement(t)&&((n=e[this.prevIndex])==null||n.setAttribute(\"tabindex\",\"-1\"),t.setAttribute(\"tabindex\",\"0\")))};this.handleFocusout=e=>{this.isRelatedTargetOrContainAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventKey(e.key)||e.defaultPrevented)return;let t=0;switch(this.prevIndex=this.currentIndex,e.key){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.stopKeyEventPropagation&&e.stopPropagation(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.hostDelegatesFocus=t||!1,this.stopKeyEventPropagation=u||!1,this.host=e,this.host.addController(this),this._elements=i,this.isFocusableElement=c||this.isFocusableElement,this._direction=o(n,\"string\",this._direction),this.elementEnterAction=s||this.elementEnterAction,this._focusInIndex=o(h,\"number\",this._focusInIndex),this._listenerScope=o(l,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}reset(){var n;const e=this.elements;if(!e.length)return;this.setCurrentIndexCircularly(this.focusInIndex-this.currentIndex);let t=e[this.currentIndex];this.currentIndex<0||((!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=e[this.currentIndex]),t&&this.isFocusableElement(t)&&((n=e[this.prevIndex])==null||n.setAttribute(\"tabindex\",\"-1\"),t.setAttribute(\"tabindex\",\"0\")))}focusOnItem(e,t){var i;const n=this.elements||[],s=!e||!this.isFocusableElement(e)?-1:n.indexOf(e);s>-1&&(this.currentIndex=s,(i=n[this.prevIndex])==null||i.setAttribute(\"tabindex\",\"-1\")),this.focus(t)}focus(e){var s;const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&((!this.hostDelegatesFocus||t[this.prevIndex]!==n)&&((s=t[this.prevIndex])==null||s.setAttribute(\"tabindex\",\"-1\")),n.tabIndex=0,n.focus(e),this.hostDelegatesFocus&&!this.focused&&this.hostContainsFocus())}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(t=>{this.mutationObserver.observe(t,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t;this.prevIndex=this.currentIndex;let s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetOrContainAnElement(e){const t=e.relatedTarget,n=this.elements.includes(t),s=this.elements.some(i=>i.contains(t));return!(n||s)}acceptsEventKey(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.addEventListener(\"click\",this.handleClick)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.host.removeEventListener(\"click\",this.handleClick)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}\n//# sourceMappingURL=FocusGroup.js.map\n"],"names":["o","r","e","t","FocusGroupController","constructor","hostDelegatesFocus","direction","n","elementEnterAction","s","elements","i","focusInIndex","h","isFocusableElement","c","listenerScope","l","stopKeyEventPropagation","u","this","_currentIndex","prevIndex","_direction","directionLength","_focused","_focusInIndex","_listenerScope","host","offset","recentlyConnected","handleFocusin","isEventWithinListenerScope","composedPath","find","indexOf","currentIndex","isRelatedTargetOrContainAnElement","hostContainsFocus","handleClick","length","setCurrentIndexCircularly","setAttribute","handleFocusout","hostNoLongerContainsFocus","handleKeydown","acceptsEventKey","key","defaultPrevented","preventDefault","stopPropagation","focus","mutationObserver","MutationObserver","handleItemMutation","addController","_elements","cachedElements","focused","focusInElement","includes","clearElementCache","update","unmanage","manage","reset","focusOnItem","tabIndex","disconnect","requestAnimationFrame","forEach","observe","attributes","addEventListener","removeEventListener","relatedTarget","some","contains","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","hostUpdated"],"mappings":"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"}